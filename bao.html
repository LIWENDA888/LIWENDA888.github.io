<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>素材库 - 自在造字(ZIZAO)</title>
    <meta name="description" content="自在造字，专注字体字库产品制作与分享">
    <meta name="author" content="自在造字">
    <meta property="og:title" content="素材库 - 自在造字(ZIZAO)">
    <meta property="og:image" content="https://pic3.fukit.cn/autoupload/NWINCyTOTWqNUcPQazQq69iO_OyvX7mIgxFBfDMDErs/20251101/abRh/500X180/logo.png/webp">
    <meta property="og:url" content="https://www.zizao.top">
    <meta property="og:type" content="website">
    <link rel="icon" href="https://pic3.fukit.cn/autoupload/NWINCyTOTWqNUcPQazQq69iO_OyvX7mIgxFBfDMDErs/20251101/8hkj/ico.ico" type="zizaoicon">
    
    <style>
        /* --- CSS 样式部分 --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
        }

        html, body {
            height: 100%;
            min-height: 100vh;
        }

        /* 主体背景色改为白色 */
        body {
            background-color: #ffffff; 
            color: #1a1a1a;
        }

        /* 页面包裹器 */
        .page-wrapper {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- 导航栏样式 --- */
        .navbar {
            position: sticky; 
            top: 0;
            left: 0;
            width: 100%;
            height: 80px;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.03);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 60px; 
            z-index: 1000;
            transition: all 0.4s ease;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.02);
        }
        
        .main-content { 
            flex-grow: 1; 
            padding-top: 40px; 
            width: 100%; 
            display: flex; 
            justify-content: center;
        }

        /* 导航栏内部元素 */
        .navbar-logo { display: flex; align-items: center; text-decoration: none; }
        .navbar-logo img { height: 30px; width: auto; display: block; }
        .menu-toggle { display: none; background: none; border: none; cursor: pointer; padding: 10px; z-index: 1001; }
        .menu-toggle-icon { display: block; width: 25px; height: 2px; background-color: #1a1a1a; position: relative; transition: all 0.3s ease; }
        .menu-toggle-icon::before, .menu-toggle-icon::after { content: ''; position: absolute; width: 100%; height: 2px; background-color: #1a1a1a; transition: all 0.3s ease; }
        .menu-toggle-icon::before { top: -8px; }
        .menu-toggle-icon::after { top: 8px; }
        .navbar-menu { display: flex; list-style: none; gap: 50px; height: 100%; align-items: center; }
        .menu-item { position: relative; height: 100%; display: flex; align-items: center; cursor: pointer; }
        .menu-link { text-decoration: none; color: #1a1a1a; font-size: 15px; font-weight: 500; letter-spacing: 0.5px; transition: color 0.3s ease; position: relative; }
        .menu-item:hover .menu-link { color: #444444; }
        .menu-link::after { content: ''; position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); width: 0; height: 2px; background-color: #1a1a1a; transition: width 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); border-radius: 2px; }
        .menu-item:hover .menu-link::after { width: 20px; }
        .dropdown { position: absolute; top: 80px; left: 50%; transform: translateX(-50%) translateY(20px); background-color: rgba(255, 255, 255, 0.98);backdrop-filter: blur(10px); min-width: 220px; padding: 20px 0; border-radius: 4px; box-shadow: 0 15px 40px rgba(0, 0, 0, 0.08); opacity: 0; visibility: hidden; transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); }
        .menu-item:hover .dropdown { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }
        .dropdown li { list-style: none; }
        .dropdown-link { display: block; padding: 12px 30px; text-decoration: none; color: #666; font-size: 14px; transition: all 0.3s ease; display: flex; justify-content: space-between; align-items: center; }
        .dropdown-link:hover { color: #000; background-color: #fff; padding-left: 35px; }
        .dropdown-link::after { content: '→'; font-size: 12px; color: #1a1a1a; opacity: 0; transform: translateX(-10px); transition: all 0.3s ease; }
        .dropdown-link:hover::after { opacity: 1; transform: translateX(0); }
        .navbar-actions { display: flex; align-items: center; }
        .btn-primary {
            padding: 8px 28px; background-color: #1a1a1a; color: #fff; text-decoration: none;
            font-size: 14px; font-weight: 600; border-radius: 50px; border: 1px solid #1a1a1a;
            display: flex; align-items: center; gap: 0; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); 
        }
        .btn-primary:hover {
            background-color: #333333; border-color: #333333; color: #fff; transform: translateY(-1px); 
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2); 
        }

        /* --- 布局容器 --- */
        .doc-container {
            width: 100%;
            max-width: 1600px; 
            margin: 0 auto 40px; 
            padding: 0 30px; 
            display: flex;
            gap: 30px; 
        }

        /* --- 侧边栏 Sidebar --- */
        .sidebar {
            width: 300px; 
            flex-shrink: 0; 
            position: sticky; 
            top: 120px; 
            max-height: calc(100vh - 160px); 
            overflow-y: auto; 
            background-color: transparent; 
            box-shadow: none; 
            border: 1px solid rgba(0, 0, 0, 0.08); 
            border-radius: 12px; 
            padding: 10px 0; 
        }
        /* 隐藏侧边栏的滚动条 */
        .sidebar::-webkit-scrollbar { width: 0; }
        .sidebar { -ms-overflow-style: none; scrollbar-width: none; }


        /* 侧边栏菜单样式 */
        .sidebar-menu { list-style: none; padding: 0 10px; }
        .category-item { margin-bottom: 2px; }
        .category-header { 
            padding: 12px 15px; font-weight: 700; color: #1a1a1a; cursor: pointer; 
            transition: all 0.2s ease; font-size: 16px; border-radius: 8px; margin-top: 10px; 
            display: flex; justify-content: space-between; align-items: center; 
        }
        /* 侧边栏主标题 Hover 优化 */
        .category-header:hover { 
            background-color: rgba(0,0,0,0.03); 
            transform: translateX(2px); 
        }
        .category-header span { font-size: 10px; transition: transform 0.3s ease; transform: rotate(-90deg); color: #999; }
        .category-header.open span { transform: rotate(0deg); }
        .subcategory-list { 
            list-style: none; 
            overflow: hidden; 
            max-height: 0; 
            transition: max-height 0.4s ease-out; 
            background-color: transparent; 
            margin: 0 5px 8px 5px; 
            padding: 0; 
        }
        .subcategory-link { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 10px 15px 10px 20px; text-decoration: none; color: #666; font-size: 15px; 
            transition: all 0.2s ease; border-radius: 6px; 
        }
        .subcategory-link:hover { color: #1a1a1a; background-color: rgba(0,0,0,0.02); } 
        .subcategory-link.active { color: #1a1a1a; font-weight: 600; background-color: rgba(0,0,0,0.05); } 
        .count-badge { font-size: 12px; background: rgba(0,0,0,0.04); color: #666; padding: 2px 8px; border-radius: 10px; font-weight: normal; } 
        
        /* --- 搜索框样式调整 --- */
        .search-container {
            width: 100%;
            /* 增加左右内边距，使其与 .sidebar-menu 对齐 */
            padding: 0 10px; 
            margin-bottom: 0;
        }

        #font-search-input {
            width: 100%;
            padding: 12px 20px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            transition: all 0.3s ease;
            outline: none;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            -webkit-appearance: none; 
            /* 增加底外边距，以分隔搜索框和下面的分类菜单 */
            margin-bottom: 10px; 
        }

        #font-search-input:focus {
            border-color: #1a1a1a;
            box-shadow: 0 0 0 3px rgba(26, 26, 26, 0.1);
        }
        /* --- 右侧内容区域 --- */
        .content-area {
            flex-grow: 1;
            background-color: transparent; 
            padding: 0; 
            border-radius: 0;
            box-shadow: none;
            border: none;
            display: flex;
            flex-direction: column;
        }

        .grid-header {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        .grid-header h2 { font-size: 24px; color: #1a1a1a; font-weight: 700; }
        .grid-header p { font-size: 14px; color: #666; margin-top: 5px; }

        .font-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); 
            gap: 15px; 
            width: 100%;
        }

        /* --- 字体卡片组件 (应用浅渐变背景) --- */
        .font-card {
            /* 基础背景色 */
            background: #ffffff; 
            /* 浅渐变效果 */
            background-image: linear-gradient(180deg, #ffffff, #fcfcfc); 
            
            border-radius: 10px; 
            border: 1px solid rgba(0,0,0,0.08); 
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none; 
            color: inherit; 
            padding: 15px 20px; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 80px; 
            overflow: hidden; 
        }

        .font-card:hover {
            transform: none; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); /* 稍微增强阴影 */
            border-color: rgba(0,0,0,0.15); 
        }
        
        .card-info {
            padding: 0;
            display: block; 
            flex-shrink: 1; 
        }

        .font-name {
            font-size: 18px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 4px; 
            line-height: 1.2;
        }

        .font-author {
            font-size: 13px;
            color: #888;
            margin-bottom: 0;
        }

        .card-footer {
            flex-shrink: 0; 
            margin-top: 0;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            border-top: none; 
            padding-top: 0;
            gap: 20px;
            margin-left: 20px;
        }

        .font-specs {
            font-size: 13px; 
            color: #666; 
            display: flex;
            gap: 10px;
        }

        .btn-view {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
            text-decoration: none; 
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap; 
        }
        .btn-view::after {
            content: '→';
            font-size: 14px;
            transition: transform 0.2s;
        }
        .font-card:hover .btn-view::after {
            transform: translateX(3px);
        }

        .empty-state {
            width: 100%;
            padding: 60px;
            text-align: center;
            color: #999;
            background: #fff;
            border: 1px dashed #ddd;
            border-radius: 12px;
        }

        /* --- 分页样式 --- */
        .pagination-container {
            margin-top: 30px;
            margin-bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .page-link {
            padding: 8px 14px;
            border: 1px solid #ddd;
            border-radius: 6px;
            text-decoration: none;
            color: #666;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            background-color: #fff;
            user-select: none;
        }
        
        .page-link:hover:not(.active):not(.disabled) {
            border-color: #aaa;
            color: #1a1a1a;
        }

        .page-link.active {
            background-color: #1a1a1a;
            border-color: #1a1a1a;
            color: #fff;
            font-weight: 600;
            cursor: default;
        }

        .page-link.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-link.nav-arrow {
            font-size: 16px;
            padding: 8px 12px;
            font-weight: bold;
        }
        .page-link.nav-arrow.prev::before { content: '<'; } 
        .page-link.nav-arrow.next::before { content: '>'; } 


        /* --- Footer --- */
        .footer { 
            flex-shrink: 0; 
            padding: 40px 60px; 
            text-align: center; 
            color: #888; 
            font-size: 14px; 
            border-top: 1px solid rgba(0, 0, 0, 0.05); 
            width: 100%; 
            background-color: #fff; 
        }

        /* --- 响应式 --- */
        @media (max-width: 768px) {
            .navbar { height: 60px; padding: 0 20px; }
            .navbar-actions { display: none; }
            .menu-toggle { display: block; order: 3; }
            
            .navbar-menu { 
                position: absolute; top: 60px; left: 0; width: 100%; height: auto;
                max-height: calc(100vh - 60px); flex-direction: column; background-color: #fff;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); padding: 20px 0; gap: 0; overflow-y: auto;
                transform: translateY(-100%); visibility: hidden; opacity: 0; transition: all 0.4s ease-out;
            }
            .navbar-menu.active { transform: translateY(0); visibility: visible; opacity: 1; }
            .menu-item { width: 100%; padding: 10px 20px; align-items: flex-start; }
            .menu-link { width: 100%; padding: 10px 0; font-size: 16px; font-weight: 600; }
            .dropdown { position: static; transform: none; width: 100%; box-shadow: none; background-color: #f7f7f7; opacity: 1; visibility: visible; display: none; }
            .menu-item:hover .dropdown { display: block; }

            .main-content { padding-top: 20px; }
            .doc-container { flex-direction: column; gap: 20px; padding: 0 20px; }
            
            .sidebar { 
                width: 100%; 
                position: static; 
                max-height: none; 
                padding: 0;
                border: none; 
                box-shadow: none;
                background: transparent;
            }
            .category-header { background: #fff; border: 1px solid #eee; }
            .subcategory-list { margin-bottom: 10px; border: 1px solid #eee; border-top: none; border-radius: 0 0 8px 8px; background: #fff; }

            .content-area { padding: 0; }
            .font-grid { grid-template-columns: repeat(auto-fill, minmax(100%, 1fr)); gap: 15px; }
        }

    </style>
    </head>
<body>

    <div class="page-wrapper">
        
        <nav class="navbar" id="navbar">
            </nav>

        <div class="main-content">
            <div class="doc-container">
                
                <aside class="sidebar" id="sidebar">
                    <div class="search-container">
                        <input type="text" id="font-search-input" placeholder="输入字体名称进行搜索...">
                    </div>
                    
                    <ul class="sidebar-menu">
                        <li class="category-item" data-category="category">
                            <div class="category-header open">字体分类<span class="collapse-icon">▼</span></div>
                            <ul class="subcategory-list" style="max-height: 500px;">
                                <li><a href="#sans_serif" class="subcategory-link" data-hash="sans_serif">黑体 / Sans <span class="count-badge" id="count-sans_serif">0</span></a></li>
                                <li><a href="#serif" class="subcategory-link" data-hash="serif">宋体 / Serif <span class="count-badge" id="count-serif">0</span></a></li>
                                <li><a href="#display" class="subcategory-link" data-hash="display">创意 / Display <span class="count-badge" id="count-display">0</span></a></li>
                            </ul>
                        </li>
                    </ul>
                </aside>

                <main class="content-area" id="content-area">
                    
                    <div class="grid-header">
                        <div>
                            <h2 id="grid-title">黑体 / Sans-serif</h2>
                            <p id="grid-desc">浏览我们精心挑选的字体库</p>
                        </div>
                    </div>
                    
                    <div class="font-grid" id="font-grid-container">
                        </div>
                    
                    <div class="pagination-container" id="pagination-container">
                        
                    </div>
                </main>

            </div>
        </div>
        
        <footer class="footer" id="footer">
            </footer>

    </div> 
    
    <script src="https://www.zizao.top/pages/common.js"></script> 

    <script>
        // --- 1. 数据映射和常量 (统一筛选映射表) ---
        const FILTER_MAP = {
            // 字体分类 (Category) 标题
            'sans_serif': '黑体 / Sans-serif',
            'serif': '宋体 / Serif',
            'display': '创意 / Display',
        };
        
        const CARDS_PER_PAGE = 12; // 每页显示 12 张卡片
        let State = {
            currentPage: 1,
            currentFilter: 'sans_serif', // 当前激活的分类
            searchQuery: '' // 当前搜索词
        };
        
        // --- 2. 字体数据源 ---
        const DEFAULT_COVER = "https://tc-new.z.wiki/autoupload/NWINCyTOTWqNUcPQazQq69iO_OyvX7mIgxFBfDMDErs/20251005/KII0/930X710/index1.jpg/webp";

        const FONT_DATA = [
            { id: 1, name: "自在起点黑 VF", author: "FontStudio", category: "sans_serif", style: "modern", tags: ["商用", "极简"], weight: "2025年8月7日", cover: DEFAULT_COVER },
            { id: 2, name: "经典宋体 Std", author: "TypeFoundry", category: "serif", style: "retro", tags: ["书籍", "正文"], weight: "4 Styles", cover: DEFAULT_COVER },
            { id: 3, name: "流光手写体", author: "HandWriter", category: "display", style: "retro", tags: ["手写", "艺术"], weight: "1 Style", cover: DEFAULT_COVER },
            { id: 4, name: "赛博朋克 2077", author: "GlitchType", category: "display", style: "tech", tags: ["标题", "科技"], weight: "2 Styles", cover: DEFAULT_COVER },
            { id: 5, name: "柔和黑体 Soft", author: "FontStudio", category: "sans_serif", style: "modern", tags: ["UI设计", "圆润"], weight: "8 Styles", cover: DEFAULT_COVER },
            { id: 6, name: "报刊明朝体", author: "NewsType", category: "serif", style: "modern", tags: ["印刷", "报纸"], weight: "3 Styles", cover: DEFAULT_COVER },
            { id: 7, name: "像素积木", author: "8BitMaster", category: "display", style: "tech", tags: ["游戏", "复古"], weight: "1 Style", cover: DEFAULT_COVER },
            { id: 8, name: "工业黑体", author: "Mechanic", category: "sans_serif", style: "tech", tags: ["重工", "标题"], weight: "Bold Only", cover: DEFAULT_COVER }
        ];

        // --- 3. 辅助函数：防抖 (Debounce) ---
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        }

        // --- 4. 渲染函数：导航栏 ---
        function renderNavbar() {
            if (typeof APP_DATA === 'undefined' || !APP_DATA.navData) return;
            const data = APP_DATA.navData;
            const navbar = document.querySelector('#navbar');
            if (!navbar) return;
            let html = data.logoHtml;
            html += `<button class="menu-toggle"><span class="menu-toggle-icon"></span></button>`;
            let menuHtml = '<ul class="navbar-menu">';
            data.menuItems.forEach(item => {
                let dropdownHtml = '';
                if (item.dropdown && item.dropdown.length > 0) {
                    dropdownHtml = '<ul class="dropdown">';
                    item.dropdown.forEach(ddItem => {
                        const isSeparator = ddItem.separator ? ' style="border-top: 1px solid #f5f5f5; padding-top: 8px; margin-top: 8px;"' : '';
                        dropdownHtml += `<li${isSeparator}><a href="${ddItem.link}" class="dropdown-link">${ddItem.name}</a></li>`;
                    });
                    dropdownHtml += '</ul>';
                }
                const linkContent = `<a href="${item.link}" class="menu-link">${item.name}</a>`;
                menuHtml += `<li class="menu-item">${linkContent}${dropdownHtml}</li>`;
            });
            menuHtml += '</ul>';
            html += menuHtml;
            if (data.actionButton) {
                const targetAttr = data.actionButton.target ? `target="${data.actionButton.target}"` : '';
                const relAttr = data.actionButton.rel ? `rel="${data.actionButton.rel}"` : '';
                html += `<div class="navbar-actions"><a href="${data.actionButton.link}" class="btn-primary" ${targetAttr} ${relAttr}><span>${data.actionButton.text}</span></a></div>`;
            }
            navbar.innerHTML = html;
        }


        // --- 5. 渲染函数：底部 ---
        function renderFooter() {
             if (typeof APP_DATA === 'undefined' || !APP_DATA.footerData) return;
            const footer = document.querySelector('#footer');
            if (footer) footer.innerHTML = APP_DATA.footerData.copyright;
        }

        // --- 6. 渲染分页控件 ---
        function renderPagination(totalPages, currentPage) {
            const container = document.getElementById('pagination-container');
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            let html = '';
            
            // 上一页
            const prevDisabled = currentPage === 1 ? 'disabled' : '';
            html += `<a href="#" class="page-link nav-arrow prev ${prevDisabled}" data-page="${currentPage - 1}"></a>`; 

            // 页码 
            const maxPageLinks = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxPageLinks / 2));
            let endPage = Math.min(totalPages, startPage + maxPageLinks - 1);
            
            if (endPage - startPage + 1 < maxPageLinks) {
                startPage = Math.max(1, endPage - maxPageLinks + 1);
            }

            for (let i = startPage; i <= endPage; i++) {
                const active = i === currentPage ? 'active' : '';
                html += `<a href="#" class="page-link ${active}" data-page="${i}">${i}</a>`;
            }

            // 下一页
            const nextDisabled = currentPage === totalPages ? 'disabled' : '';
            html += `<a href="#" class="page-link nav-arrow next ${nextDisabled}" data-page="${currentPage + 1}"></a>`;

            container.innerHTML = html;

            // 绑定点击事件
            container.querySelectorAll('.page-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (e.currentTarget.classList.contains('disabled')) return;
                    
                    const newPage = parseInt(e.currentTarget.getAttribute('data-page'));
                    
                    // 调用核心渲染函数，使用当前的状态进行分页
                    renderGrid(State.currentFilter, newPage, State.searchQuery);
                    
                    // 滚动到卡片顶部
                    document.getElementById('grid-title').scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            });
        }
        
        // --- 7. 核心逻辑：卡片网格渲染 ---
        function renderGrid(filter, page = 1, searchQuery = '') {
            const gridContainer = document.getElementById('font-grid-container');
            const titleEl = document.getElementById('grid-title');
            const descEl = document.getElementById('grid-desc');
            const searchInput = document.getElementById('font-search-input');
            
            if (!gridContainer || !titleEl || !descEl || !searchInput) return;

            let filteredData = [];
            let pageTitle = '';
            
            // 1. 数据过滤逻辑
            if (searchQuery) {
                // 搜索模式
                searchQuery = decodeURIComponent(searchQuery).trim();
                
                // Case-insensitive search on font name
                filteredData = FONT_DATA.filter(item => 
                    item.name.toLowerCase().includes(searchQuery.toLowerCase())
                );
                
                pageTitle = `搜索结果: "${searchQuery}"`;
                
                // 更新 State
                State.searchQuery = searchQuery;
                State.currentFilter = ''; // 清除分类状态
            } else {
                // 分类筛选模式
                State.searchQuery = '';
                
                const effectiveFilter = (filter && FILTER_MAP[filter]) ? filter : 'sans_serif';
                
                filteredData = FONT_DATA.filter(item => item.category === effectiveFilter);
                
                pageTitle = FILTER_MAP[effectiveFilter] || "字体库";
                
                // 更新 State
                if (State.currentFilter !== effectiveFilter) {
                    State.currentPage = 1; // 切换分类时重置页码
                }
                State.currentFilter = effectiveFilter;
            }

            // 2. 更新状态 (currentPage 需要在筛选后确保有效)
            const totalCards = filteredData.length;
            const totalPages = Math.ceil(totalCards / CARDS_PER_PAGE);
            const currentPage = Math.min(page, totalPages > 0 ? totalPages : 1);
            State.currentPage = currentPage; 
            
            const startIndex = (currentPage - 1) * CARDS_PER_PAGE;
            const endIndex = startIndex + CARDS_PER_PAGE;
            const paginatedData = filteredData.slice(startIndex, endIndex);

            // 3. 设置标题和描述
            let pageDesc = `共找到 ${totalCards} 款字体`;
            if (totalPages > 1) {
                 pageDesc += ` (当前第 ${currentPage} / ${totalPages} 页)`;
            }

            titleEl.innerText = pageTitle;
            descEl.innerText = pageDesc;
            
            // 4. 同步搜索框的值
            searchInput.value = State.searchQuery;


            // 5. 生成卡片 HTML 
            if (paginatedData.length === 0) {
                gridContainer.innerHTML = `<div class="empty-state">暂无相关字体数据</div>`;
                gridContainer.style.display = 'block'; 
            } else {
                gridContainer.style.display = 'grid';
                let cardsHtml = '';
                
                paginatedData.forEach(font => {
                    const detailLink = `#font-detail-${font.id}`; 
                    
                    cardsHtml += `
                        <a href="${detailLink}" target="_blank" class="font-card">
                            <div>
                                <div class="font-name">${font.name}</div>
                                <div class="font-author">${font.author}</div> 
                            </div>
                            <div class="card-footer">
                                <div class="font-specs">${font.weight}</div>
                                <span class="btn-view">查看</span>
                            </div>
                        </a>
                    `;
                });
                gridContainer.innerHTML = cardsHtml;
            }

            // 6. 渲染分页控件
            renderPagination(totalPages, currentPage);

            // 7. 更新左侧菜单的激活状态 (搜索模式下取消所有高亮)
            document.querySelectorAll('.subcategory-link').forEach(link => {
                link.classList.remove('active');
                if (!State.searchQuery && link.getAttribute('data-hash') === State.currentFilter) {
                    link.classList.add('active');
                    // 自动展开/设置高度的逻辑保持不变
                    const parentHeader = link.closest('.category-item')?.querySelector('.category-header');
                    if (parentHeader && !parentHeader.classList.contains('open')) {
                        const parentList = link.closest('.subcategory-list');
                        if (parentList) {
                            parentHeader.classList.add('open');
                            parentList.style.maxHeight = parentList.scrollHeight + 'px'; 
                        }
                    }
                }
            });
        }

        // --- 8. 辅助功能：更新侧边栏计数 ---
        function updateSidebarCounts() {
            document.getElementById('count-sans_serif').innerText = FONT_DATA.filter(i => i.category === 'sans_serif').length;
            document.getElementById('count-serif').innerText = FONT_DATA.filter(i => i.category === 'serif').length;
            document.getElementById('count-display').innerText = FONT_DATA.filter(i => i.category === 'display').length;
        }
        
        // --- 9. 核心功能：处理 Hash 变化 ---
        function handleHashChange(hash) {
            let filter = '';
            let search = '';
            
            // 默认从 hash 中解析分类，如果检测到搜索格式，则切换为搜索模式
            if (hash.startsWith('search=')) {
                search = hash.substring(7); // "search=".length is 7
                renderGrid(filter, 1, search);
            } else {
                filter = hash;
                renderGrid(filter, 1, search);
            }
        }

        // --- 10. 页面初始化与事件绑定 ---
        function initPage() {
            // 侧边栏折叠菜单点击事件
            document.querySelectorAll('.category-header').forEach(header => {
                header.addEventListener('click', (e) => {
                    const list = e.currentTarget.nextElementSibling;
                    e.currentTarget.classList.toggle('open');
                    if (e.currentTarget.classList.contains('open')) {
                        list.style.maxHeight = list.scrollHeight + 'px';
                    } else {
                        list.style.maxHeight = '0';
                    }
                });
            });

            // 监听 Hash 变化，作为统一入口
            window.addEventListener('hashchange', () => {
                const newHash = window.location.hash.slice(1);
                handleHashChange(newHash);
            });
            
            // 绑定搜索框事件
            const searchInput = document.getElementById('font-search-input');
            searchInput.addEventListener('input', debounce(() => {
                const query = searchInput.value.trim();
                let newHash = '';
                if (query) {
                    // 如果有搜索词，设置 hash 为 search=query
                    newHash = `search=${encodeURIComponent(query)}`;
                } else {
                    // 如果搜索框被清空，则切换回当前激活的分类
                    newHash = State.currentFilter || 'sans_serif';
                }
                window.location.hash = newHash;
            }, 300)); // 300ms 防抖，优化性能

            // 初始渲染
            updateSidebarCounts();
            const initialHash = window.location.hash.slice(1);
            handleHashChange(initialHash || 'sans_serif'); // 初始时调用一次，使用默认分类
        }

        document.addEventListener('DOMContentLoaded', () => {
            // 检查外部 APP_DATA 是否加载，如果没有则定义一个空的以防报错
            if (typeof APP_DATA === 'undefined') {
                window.APP_DATA = {
                    navData: { logoHtml: '<a href="#" class="navbar-logo"><img src="logo.svg" alt="Logo"></a>', menuItems: [], actionButton: null },
                    footerData: { copyright: '© 2025 Font Library. All rights reserved.' }
                };
            }
            
            renderNavbar();
            renderFooter();

            const menuToggle = document.querySelector('.menu-toggle');
            const menu = document.querySelector('.navbar-menu');
            if (menuToggle && menu) {
                menuToggle.addEventListener('click', () => {
                    menu.classList.toggle('active');
                });
            }
            
            initPage();
        });
    </script>
</body>
</html>