<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在线预览字体 - 自在造字（字造ZIZAO）</title>
    <meta name="description" content="字造产品展示，提供优质的字库产品和设计资源。">
    <link rel="icon" href="https://tc.z.wiki/autoupload/f/NWINCyTOTWqNUcPQazQq69iO_OyvX7mIgxFBfDMDErs/20250803/gOQi/ico.ico" type="zizaoicon">
    <style>
        /* 基础重置和变量定义 */
        * { margin: 0; padding: 0; box-sizing: border-box; } 
        
        :root {
            --bg-color: #f7f7f7;
            --text-color: #1a1a1a;
            --dock-bg: rgba(255, 255, 255, 0.85); 
            --dock-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); 
            --primary-color: #007bff;
            --border-color: #e0e0e0;
            --card-bg-color: #ffffff;
            --dock-height: 140px; 
            --dock-collapsed-height: 48px; /* 收起后高度 48px (不变) */
            --global-font-size: 14px; 
            
            /* 颜色变量 (省略不变部分) */
            --deep-grey: #222222;
            --light-grey: #CCCCCC;
            --accent-color: #E0B973; 
            --nav-hover-bg: rgba(224, 185, 115, 0.1); 
            --sidebar-bg: #FFFFFF; 
            --link-color: #4a4a4a; 
            
            /* 通知栏美化变量 (省略不变部分) */
            --notice-bg: #f9f9f9; 
            --notice-shadow: 0 -4px 15px rgba(0, 0, 0, 0.05); 
            --notice-primary: #198754; 
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            padding-top: 81px; 
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6; 
            opacity: 0; 
            transition: background-color 0.3s, color 0.3s, opacity 0.5s; 
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            font-size: var(--global-font-size); 
            scroll-behavior: smooth; 
        }

        a { color: var(--link-color); text-decoration: none; transition: color 0.3s; } 

        /* ----------------------- 顶部栏样式 (不变) ----------------------- */
        .header {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 5%; 
            background-color: #FFFFFF;
            border-bottom: 1px solid var(--light-grey); 
            height: 80px; 
            box-sizing: border-box;
        }

        .logo { display: block; } 
        .logo img { height: 28px; max-width: 150px; display: block; }

        .nav { display: flex; align-items: center; height: 100%; }
        .nav-item-dropdown { 
            position: relative; list-style: none; margin-left: 15px; 
            height: 100%; display: flex; align-items: center; 
        }

        /* 导航链接 */
        .nav-item-dropdown > a {
            font-size: 16px; 
            font-weight: 500;
            display: inline-flex; 
            align-items: center;
            padding: 5px 10px 10px 10px; 
            height: auto; 
            border-radius: 4px; position: relative;
            color: var(--deep-grey);
        }
        
        .nav-item-dropdown > a::after {
            content: ''; position: absolute; bottom: 0; left: 50%;
            width: 50%; height: 3px; background-color: var(--accent-color); 
            transform: translateX(-50%) scaleX(0); transition: transform 0.3s ease-out;
        }
        
        .nav-item-dropdown > a:hover { color: var(--deep-grey); }
        .nav-item-dropdown:hover > a::after { transform: translateX(-50%) scaleX(1); }
        
        /* 桌面端二级菜单 */
        .dropdown-menu {
            position: absolute; top: 100%; left: 50%; transform: translateX(-50%) translateY(0); 
            min-width: 150px; background-color: #FFFFFF;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08); border-radius: 6px; padding: 8px 0; 
            z-index: 100; display: none; opacity: 0;
            transition: opacity 0.2s, transform 0.2s;
        }
        
        .nav-item-dropdown:hover .dropdown-menu {
            display: block; opacity: 1; 
        }
        
        .dropdown-menu a {
            display: block; padding: 8px 15px; font-size: 15px;
            white-space: nowrap; border-radius: 4px; margin: 0 8px;
            color: var(--text-color);
        }

        .dropdown-menu a:hover { background-color: var(--nav-hover-bg); }

        .menu-toggle {
            display: none; background: none; border: none; font-size: 24px;
            cursor: pointer; color: var(--deep-grey); padding: 0 10px; z-index: 999; 
        }

        /* 侧边栏遮罩层 */
        .backdrop {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.5); z-index: 990; 
            opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s;
        }

        .backdrop.open { opacity: 1; visibility: visible; }
        
        /* ----------------------- 底部通知横幅样式 (不变) ----------------------- */
        .bottom-notice-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; z-index: 1500; 
            background-color: var(--notice-bg); 
            color: var(--text-color); 
            padding: 15px 0; 
            display: flex; justify-content: center; 
            align-items: center; 
            box-shadow: var(--notice-shadow); 
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            transition: transform 0.3s ease-out;
            transform: translateY(0); 
        }

        .bottom-notice-bar.hidden { transform: translateY(100%); }
        
        .notice-inner-wrapper {
            display: flex; justify-content: space-between; align-items: center;
            width: 95%; max-width: 1000px; 
        }

        .notice-content {
            display: flex; align-items: center; gap: 20px; flex-grow: 1; 
        }

        .notice-title { 
            margin: 0; font-size: 16px; font-weight: 700; flex-shrink: 0; 
            color: var(--notice-primary); 
        }
        .notice-text { margin: 0; font-size: 14px; line-height: 1.4; opacity: 0.8; }

        /* 统一 notice-button 样式 */
        .notice-button {
            background: none !important; 
            color: var(--text-color) !important; 
            border: 1px solid var(--text-color) !important; 
            padding: 6px 12px !important; 
            border-radius: 999px !important; 
            cursor: pointer; 
            font-size: 14px !important; 
            transition: color 0.3s, border-color 0.3s, background-color 0.3s !important;
            flex-shrink: 0; 
            margin-left: 20px; 
            box-shadow: none !important; 
            transform: none !important;
        }

        .notice-button:hover { 
            background-color: var(--text-color) !important; 
            color: var(--card-bg-color) !important; 
            transform: none !important;
        }
        
        /* ----------------------- 底部主 Dock 栏 样式 ----------------------- */
        .main-dock {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            z-index: 1000; max-width: 1000px; width: 95%; 
            height: var(--dock-height); /* 初始高度 */
            border-radius: 16px; box-shadow: var(--dock-shadow); 
            background-color: var(--dock-bg); border: 1px solid var(--border-color);
            padding: 12px 20px; box-sizing: border-box; display: flex;
            flex-direction: column; backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            /* 启用平滑过渡 */
            transition: height 0.3s ease-in-out, transform 0.3s ease-in-out, padding 0.3s ease-in-out; 
            overflow: hidden; 
        }
        
        /* Dock 栏收起状态 */
        .main-dock.collapsed {
            height: var(--dock-collapsed-height);
            /* 【主要修改点】顶部和底部的内边距都改为 6px，使内容在 48px 高度内更居中 */
            padding: 6px 20px; 
            display: flex; 
            flex-direction: column;
            justify-content: flex-start;
            align-items: stretch;
        }

        /* 隐藏收起状态下的内容: 只隐藏文本输入框 */
        .main-dock.collapsed .text-input {
            display: none !important; /* 确保强制隐藏 */
        }

        /* Dock 栏主体行 */
        .dock-main-row {
            display: flex; 
            justify-content: space-between; 
            align-items: center; /* 确保垂直居中 */
            gap: 20px; 
            padding-bottom: 8px; border-bottom: 1px dashed var(--border-color); 
            margin-bottom: 8px; 
            flex-wrap: nowrap; 
        }

        /* 收起状态下，移除分隔线和底部空白 */
        .main-dock.collapsed .dock-main-row {
            border-bottom: none; 
            margin-bottom: 0;
            padding-bottom: 0;
            justify-content: space-between; 
        }
        
        /* 新增样式：包裹除了按钮之外的所有控制项 */
        .dock-main-controls {
            display: flex; 
            flex-wrap: nowrap; 
            gap: 20px; 
            flex-grow: 1; 
            align-items: center;
        }

        .header-logo { display: none; }
        
        /* 收起/弹出按钮样式 */
        .dock-toggle-btn {
            font-size: 14px;
            padding: 4px 10px; 
            border-radius: 999px; 
            flex-shrink: 0;
            margin-left: 10px; 
            transition: transform 0.3s;
        }

        /* 分类按钮组样式 */
        .license-filter-container {
            display: flex;
            gap: 8px; 
            flex-shrink: 0;
        }
        
        /* 分类按钮样式：继承 .action-button，只重写 active 状态 */
        .license-filter-btn {
            font-size: var(--global-font-size); 
            cursor: pointer; 
        }

        .license-filter-btn.active {
            background-color: var(--text-color) !important; 
            color: var(--card-bg-color) !important; 
            border-color: var(--text-color) !important;
        }

        .global-sliders {
            display: flex; 
            gap: 20px; 
            flex-shrink: 0; 
            align-items: center;
        }
        
        .slider-control {
            display: flex; align-items: center; gap: 8px; font-size: var(--global-font-size); 
            flex-shrink: 0; 
        }
        .slider-control span:first-child { white-space: nowrap; min-width: 28px; }

        input[type="range"] {
            width: 100px; -webkit-appearance: none; height: 5px; 
            background: var(--border-color); border-radius: 3px; cursor: pointer; outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb, 
        input[type="range"]::-moz-range-thumb {
            width: 14px; height: 14px; background: var(--primary-color);
            border-radius: 50%; cursor: pointer; box-shadow: 0 0 2px rgba(0, 0, 0, 0.2);
            -webkit-appearance: none; appearance: none; border: none;
        }
        
        .text-input {
            flex-grow: 1; width: 100%; min-height: 40px; 
            padding: 8px 10px; border: 1px solid var(--border-color);
            border-radius: 8px; box-sizing: border-box; font-size: 15px; 
            background-color: transparent; color: var(--text-color);
            resize: none; outline: none; font-family: inherit; margin-top: 0;
        }

        /* 主体内容 padding 调整 */
        .main-content {
            flex-grow: 1;
            /* 默认 padding: 140(h) + 20(b) + 30(s) = 190 */
            padding: 30px 30px calc(var(--dock-height) + 50px); 
            overflow-y: auto;
            transition: padding-bottom 0.3s ease-in-out; 
        }
        
        /* 内容区域适配 Dock 栏收起状态 */
        .main-content.dock-collapsed {
            /* 底部 Dock 高度 (48px) + 底部 Dock 距离 body 的距离 (20px) + 额外的安全距离 (30px) = 98 */
            padding-bottom: calc(var(--dock-collapsed-height) + 50px);
        }
        
        /* 字体卡片样式 (不变) */
        .font-preview-card {
            background-color: var(--card-bg-color); border: 1px solid var(--border-color);
            border-radius: 12px; margin-bottom: 20px; 
            transition: background-color 0.3s, border-color 0.3s;
        }

        .card-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px 10px; border-bottom: 1px dashed var(--border-color);
            flex-wrap: wrap; gap: 10px;
        }

        .font-info { 
            display: flex; align-items: center; gap: 10px; 
            flex-shrink: 0;
            margin-right: 15px; 
        }
        .font-name { font-size: 18px; font-weight: 600; }
        
        /* 字体授权标签样式 */
        .font-license-tag {
            font-size: 13px;
            font-weight: 500;
            color: var(--notice-primary); 
            background-color: rgba(25, 135, 84, 0.1); 
            padding: 3px 8px;
            border-radius: 4px;
            white-space: nowrap;
        }

        .font-controls {
            display: flex; align-items: center; 
            gap: 15px; 
            font-size: var(--global-font-size); 
            flex-wrap: wrap; 
            margin-left: auto; 
        }

        .font-sliders { 
            display: flex; gap: 12px; flex-wrap: wrap; 
        }
        .font-sliders input[type="range"] { width: 80px; }

        /* 通用动作按钮样式 (被卡片获取按钮、分类按钮和通知按钮复用) */
        .action-button {
            background: none; border: 1px solid var(--text-color);
            color: var(--text-color); padding: 6px 12px; border-radius: 999px; 
            cursor: pointer; font-size: 14px; text-decoration: none;
            transition: color 0.3s, border-color 0.3s, background-color 0.3s; 
            white-space: nowrap; 
        }
        
        .action-button:hover { 
            background-color: var(--text-color);
            color: var(--card-bg-color);
            border-color: var(--text-color); 
        }
        
        .font-preview-area {
            min-height: 150px; width: 100%; padding: 30px 25px; 
            line-height: 1.4; word-break: break-word; box-sizing: border-box;
            white-space: normal;
        }
        
        .font-preview-text { outline: none; cursor: text; }
        
        /* ----------------------- 底部栏样式 (隐藏) ----------------------- */
        .footer {
            display: none !important; 
        }


        /* ===================== 手机端优化（小于 768px） ===================== */
        @media (max-width: 768px) {
            
            :root {
                --dock-height: 120px;
                --dock-collapsed-height: 48px; /* 手机端也为 48px (不变) */
                --global-font-size: 13px; 
            }
            
            body { padding-top: 57px; } 
            
            .header { padding: 10px 4%; height: 56px; } 
            .menu-toggle { display: block; } 
            .main-content { padding: 15px 15px calc(var(--dock-height) + 30px); }
            
            .main-content.dock-collapsed {
                /* 底部 Dock 高度 (48px) + 底部 Dock 距离 body 的距离 (10px) + 额外的安全距离 (10px) = 68 */
                padding-bottom: calc(var(--dock-collapsed-height) + 20px); 
            }

            .main-dock {
                bottom: 10px; padding: 10px 15px; border-radius: 12px;
                width: 98%; height: var(--dock-height);
            }
            
            .main-dock.collapsed {
                /* 【主要修改点】手机端也改为 6px 15px，使内容更居中 */
                padding: 6px 15px; 
            }

            .dock-main-row {
                flex-wrap: wrap; 
                padding-bottom: 6px; margin-bottom: 6px;
                gap: 10px; 
                justify-content: flex-start; 
            }
            
            .dock-main-controls {
                flex-wrap: wrap;
                justify-content: space-between;
                order: 1; 
                flex-grow: 1;
                width: 100%;
            }

            .license-filter-container {
                flex-shrink: 1;
                order: 1;
                margin-right: auto;
            }

            .dock-toggle-btn {
                order: 2; 
                padding: 2px 8px;
                font-size: 13px;
                margin-left: auto; /* 推到右边 */
            }
            
            .global-sliders {
                order: 3; 
                flex-grow: 1; justify-content: space-between; 
                gap: 10px;
            }
            
            .slider-control {
                min-width: unset; font-size: 12px; gap: 5px; flex-shrink: 1;
            }
            
            .slider-control input[type="range"] { width: 40px; height: 3px; }
            
            .text-input { font-size: 13px; min-height: 30px; padding: 6px 8px; }
            
        }
    </style>
</head>
<body>
    
    <header class="header" id="headerContainer"></header>

    <div class="bottom-notice-bar" id="bottom-notice-bar">
        <div class="notice-inner-wrapper"> <div class="notice-content">
                <h3 class="notice-title">特别说明</h3>
                <p class="notice-text">
                    受服务器限制，当前在线体验仅支持默认文本，完整体验请下载字体至本地
                </p>
            </div>
            <button class="notice-button action-button" id="confirm-notice-btn">我已知晓</button>
        </div>
    </div>
    
    <div class="main-content" id="font-previews-container">
        </div>

    <div class="main-dock" id="main-dock">
        <div class="dock-main-row">
            
            <div class="dock-main-controls">
                
                <div class="header-logo" style="display: none;">
                    </div>
                
                <div class="license-filter-container" id="license-filter-container">
                    <button class="license-filter-btn action-button active" data-license-key="all">全部</button>
                    <button class="license-filter-btn action-button" data-license-key="免费">免费商用</button>
                    <button class="license-filter-btn action-button" data-license-key="付费">商用需授权</button>
                </div>
                
                <div class="global-sliders">
                    <div class="slider-control">
                        <span>字号</span>
                        <input type="range" id="global-font-size-slider" min="16" max="96" value="48">
                        <span id="global-font-size-value">48px</span>
                    </div>
                    <div class="slider-control">
                        <span>间距</span>
                        <input type="range" id="global-letter-spacing-slider" min="-2" max="5" step="0.1" value="0">
                        <span id="global-letter-spacing-value">0px</span>
                    </div>
                </div>
            </div>
            
            <button class="action-button dock-toggle-btn" id="dock-toggle-btn">收起</button>

        </div>
        
        <textarea class="text-input" id="global-text-input" placeholder="请在这里输入预览文本，所有字体预览将同步显示..."></textarea>
    </div>

    <footer id="footerContainer" style="display: none;"></footer>

    <script src="https://www.zizao.top/pages/common.js"></script>
    
    <script>
        
        // --- 渲染顶部栏函数 (不变) ---
        function renderHeader() {
            const headerContainer = document.getElementById('headerContainer');
            if (!headerContainer) return;

            if (typeof navData === 'undefined' || typeof siteConfig === 'undefined') {
                console.warn("common.js (navData/siteConfig) is not yet loaded. Skipping header render.");
                return;
            }

            let navHtml = navData.map(item => {
                const isDropdown = item.hasDropdown ? 'has-dropdown' : '';
                const targetAttr = item.openInNewTab ? ' target="_blank" rel="noopener noreferrer"' : '';

                let subMenuHtml = '';
                if (item.subMenu) {
                    const subLinks = item.subMenu.map(sub => {
                        const subTargetAttr = sub.openInNewTab ? ' target="_blank" rel="noopener noreferrer"' : '';
                        return `<a href="${sub.url}" class="nav-item-sub"${subTargetAttr}>${sub.label}</a>`;
                    }).join('');
                    subMenuHtml = `<div class="dropdown-menu">${subLinks}</div>`;
                }

                return `
                    <div class="nav-item-dropdown">
                        <a href="${item.url || '#'}" class="nav-item ${isDropdown}"${targetAttr}>${item.label}</a>
                        ${subMenuHtml}
                    </div>
                `;
            }).join('');

            headerContainer.innerHTML = `
                <a href="${siteConfig.homeUrl}" class="logo">
                    <img src="${siteConfig.logoUrl}" alt="品牌 LOGO" id="headerLogo">
                </a>
                <button class="menu-toggle" id="menuToggle">☰</button> 
                <div class="backdrop" id="menuBackdrop"></div>
                <nav class="nav" id="mainNav">
                    ${navHtml}
                </nav>
            `;
        }

        // --- 绑定导航事件函数 (不变) ---
        function initializeNavigationEvents() {
            const headerContainer = document.getElementById('headerContainer');
            if (!headerContainer) return;
            
            const menuToggle = document.getElementById('menuToggle');
            const mainNav = document.getElementById('mainNav');
            const menuBackdrop = document.getElementById('menuBackdrop'); 
            const dropdownItems = mainNav ? mainNav.querySelectorAll('.nav-item-dropdown') : [];

            function closeMenu() {
                if (!mainNav || !menuBackdrop) return;
                mainNav.classList.remove('open');
                menuBackdrop.classList.remove('open'); 
                document.body.style.overflow = '';
                dropdownItems.forEach(dropdown => dropdown.classList.remove('open'));
            }
            
            function toggleMenu() {
                const isOpen = mainNav.classList.toggle('open');
                menuBackdrop.classList.toggle('open'); 
                
                if (window.innerWidth <= 768) {
                    document.body.style.overflow = isOpen ? 'hidden' : ''; 
                }
                
                if (!isOpen) { 
                    closeMenu(); 
                }
            }
            
            if (menuToggle && mainNav && menuBackdrop) {
                menuToggle.addEventListener('click', toggleMenu);
                menuBackdrop.addEventListener('click', closeMenu); 
                
                mainNav.querySelectorAll('.nav-item, .nav-item-sub').forEach(item => {
                    if (!item.classList.contains('has-dropdown') || item.classList.contains('nav-item-sub')) {
                        item.addEventListener('click', () => {
                            if (mainNav.classList.contains('open')) {
                                setTimeout(closeMenu, 100); 
                            }
                        });
                    }
                });
            }
            
            dropdownItems.forEach(item => {
                const navLink = item.querySelector('.nav-item.has-dropdown');
                if (navLink) {
                    navLink.addEventListener('click', function(e) {
                        if (window.innerWidth <= 768) {
                            e.preventDefault(); 
                            const wasOpen = item.classList.contains('open');
                            dropdownItems.forEach(d => d.classList.remove('open')); 
                            if (!wasOpen) {
                                item.classList.add('open'); 
                            }
                        }
                    });
                }
            });
        }
        
        // 字体数据结构 (不变)
        const fontData = [
            { 
                name: '字造起点黑', 
                license: '免费', 
                fontFamily: 'Qidiansans', 
                minWeight: 100, 
                maxWeight: 700, 
                minWidth: 100, 
                maxWidth: 100, 
                downloadUrl: 'https://www.zizao.top/fonts/qidiansans', 
                localFontPath: 'https://cdn.jsdelivr.net/gh/LIWENDA888/LIWENDA888.github.io@main/fonts/ziku/AlimamaFangYuanTiVF-VF.woff' 
            },
            { 
                name: '字造起点圆', 
                license: '免费', 
                fontFamily: 'Qidianyuan', 
                minWeight: 100, 
                maxWeight: 700, 
                minWidth: 75, 
                maxWidth: 125, 
                downloadUrl: 'https://fonts.alibabadesign.com/download', 
                localFontPath: '1.ttf' 
            },
            { 
                name: '字造布灵布灵', 
                license: '付费', 
                fontFamily: 'bubu', 
                minWeight: 100, 
                maxWeight: 700, 
                minWidth: 125, 
                maxWidth: 125, 
                downloadUrl: 'https://fonts.alibabadesign.com/download', 
                localFontPath: '1.ttf' 
            },
        ];

        // 默认文本 (不变)
        const defaultText = "汉字之美，方寸之间见天地。Beautiful Chinese Characters.";
        
        // 存储键名，用于持久化设置
        const STORAGE_KEYS = {
            TEXT: 'previewText',
            FONT_SIZE: 'globalFontSize',
            SPACING: 'globalSpacing',
            LICENSE_FILTER: 'licenseFilter',
            DOCK_COLLAPSED: 'dockCollapsed' 
        };
        
        // 获取DOM元素
        const globalFontSizeSlider = document.getElementById('global-font-size-slider');
        const globalFontSizeValue = document.getElementById('global-font-size-value');
        const globalLetterSpacingSlider = document.getElementById('global-letter-spacing-slider');
        const globalLetterSpacingValue = document.getElementById('global-letter-spacing-value');
        const globalTextInput = document.getElementById('global-text-input');
        const previewsContainer = document.getElementById('font-previews-container'); // 主内容区域
        
        const bottomNoticeBar = document.getElementById('bottom-notice-bar');
        const confirmNoticeBtn = document.getElementById('confirm-notice-btn');
        
        const licenseFilterContainer = document.getElementById('license-filter-container');
        let currentLicenseFilter = 'all'; 

        // Dock 栏控制元素
        const mainDock = document.getElementById('main-dock');
        const dockToggleButton = document.getElementById('dock-toggle-btn');
        let isDockCollapsed = localStorage.getItem(STORAGE_KEYS.DOCK_COLLAPSED) === 'true'; // 加载状态


        // --- Load and Save Settings (不变) ---
        function loadSettings() {
            const savedText = localStorage.getItem(STORAGE_KEYS.TEXT);
            globalTextInput.value = savedText || defaultText;
            
            const savedFontSize = localStorage.getItem(STORAGE_KEYS.FONT_SIZE);
            if (savedFontSize) {
                globalFontSizeSlider.value = savedFontSize;
            }
            
            const savedSpacing = localStorage.getItem(STORAGE_KEYS.SPACING);
            if (savedSpacing) {
                globalLetterSpacingSlider.value = savedSpacing;
            }
            
            const savedLicenseFilter = localStorage.getItem(STORAGE_KEYS.LICENSE_FILTER);
            if (savedLicenseFilter) {
                currentLicenseFilter = savedLicenseFilter;
            }
        }

        function saveSetting(key, value) {
            localStorage.setItem(key, value);
        }

        // 动态注入 @font-face 规则 (不变) 
        function injectLocalFontFaces() {
            const fontStyle = document.createElement('style');
            let css = '';
            
            fontData.forEach((font) => { 
                if (font.localFontPath) {
                    const fontPath = font.localFontPath;
                    
                    let format = 'truetype';
                    if (fontPath.endsWith('.woff2')) {
                        format = 'woff2';
                    } else if (fontPath.endsWith('.otf')) {
                        format = 'opentype';
                    } else if (fontPath.endsWith('.ttf')) {
                        format = 'truetype';
                    } else if (fontPath.endsWith('.woff')) { 
                        format = 'woff';
                    }
                    
                    css 
                    += `
                        @font-face {
                            font-family: '${font.fontFamily}';
                            src: url('${fontPath}') format('${format}');
                            font-weight: ${font.minWeight} ${font.maxWeight};
                            font-stretch: ${font.minWidth}% ${font.maxWidth}%;
                            font-display: swap; 
                        }
                    `;
                }
            });

            fontStyle.textContent = css;
            document.head.appendChild(fontStyle);
        }

        // --- 字体预览卡片生成函数 (不变) ---
        function createFontPreviewCard(font, index) {
            const cardId = font.fontFamily; 
            
            const card = document.createElement('div');
            card.className = 'font-preview-card';
            card.setAttribute('data-font-id', cardId);
            const searchableName = font.name.toLowerCase().replace(/\s*\(.*?\)\s*/g, '');
            card.setAttribute('data-font-name', searchableName); 
            card.setAttribute('data-license', font.license || ''); 

            const supportsWeight = font.minWeight !== font.maxWeight;
            const supportsWidth = font.minWidth !== font.maxWidth;
            
            const initialWeight = font.minWeight;
            const initialWidth = font.minWidth; 
            
            const licenseTagHtml = font.license ? `<span class="font-license-tag">${font.license}</span>` : '';
            
            let getButtonHtml = '';
            const linkUrl = font.downloadUrl; 
            
            if (linkUrl) {
                 getButtonHtml = 
                    `<a href="${linkUrl}" class="action-button get-btn" target="_blank">获取</a>`;
            }

            card.innerHTML = `
                <div class="card-header">
                    <div class="font-info">
                        <div class="font-name">${font.name}</div>
                        ${licenseTagHtml} </div>
                    <div class="font-controls">
                        <div class="font-sliders">
                            ${supportsWeight ?
                                `
                                <div class="slider-control">
                                    <span>字重:</span>
                                    <input type="range" class="font-weight-slider" data-font-id="${cardId}" min="${font.minWeight}" max="${font.maxWeight}" step="1" value="${initialWeight}">
                                    <span class="font-weight-value">${initialWeight}</span>
                                </div>` : ''}
                            ${supportsWidth ?
                                `
                                <div class="slider-control">
                                    <span>宽度:</span>
                                    <input type="range" class="font-width-slider" data-font-id="${cardId}" min="${font.minWidth}" max="${font.maxWidth}" step="1" value="${initialWidth}">
                                    <span class="font-width-value">${initialWidth}</span>
                                </div>` : ''}
                        </div>
                        ${getButtonHtml} </div>
                </div>
                <div class="font-preview-area">
                    <div 
                        class="font-preview-text" 
                        data-font-id="${cardId}" 
                        style="
                            font-family: ${font.fontFamily}; 
                            font-weight: ${initialWeight}; 
                            font-stretch: ${initialWidth}%; 
                        "
                        contenteditable="true"
                    >${globalTextInput.value || defaultText}</div>
                </div>
            `;
            const weightSlider = card.querySelector('.font-weight-slider');
            const widthSlider = card.querySelector('.font-width-slider');
            const previewText = card.querySelector('.font-preview-text');

            if (weightSlider) {
                weightSlider.addEventListener('input', (e) => {
                    const weight = e.target.value;
                    previewText.style.fontWeight = weight;
                    card.querySelector('.font-weight-value').textContent = weight;
                });
            }

            if (widthSlider) {
                widthSlider.addEventListener('input', (e) => {
                    const width = e.target.value;
                    previewText.style.fontStretch = `${width}%`;
                    card.querySelector('.font-width-value').textContent = width;
                });
            }

            previewText.addEventListener('input', (e) => {
                // 可选：将卡片内修改同步到全局输入框
            });
            return card;
        }

        function initializeFontPreviews() {
            previewsContainer.innerHTML = '';
            fontData.forEach((font, index) => {
                previewsContainer.appendChild(createFontPreviewCard(font, index));
            });
            applyFilters();
        }
        
        // --- 过滤功能实现 (不变) ---
        
        function applyFilters() {
            const licenseFilter = currentLicenseFilter;
            
            document.querySelectorAll('.font-preview-card').forEach(card => {
                const cardLicense = card.getAttribute('data-license');
                
                let licenseMatch = false;
                if (licenseFilter === 'all') {
                    licenseMatch = true;
                } else {
                    licenseMatch = (cardLicense === licenseFilter);
                }

                if (licenseMatch) {
                    card.style.display = ''; 
                } else {
                    card.style.display = 'none'; 
                }
            });
        }
        
        // --- 底部 Dock 栏控制事件 ---
        
        // 应用 Dock 栏状态（收起/弹出）
        function applyDockState(isCollapsed) {
            if (isCollapsed) {
                mainDock.classList.add('collapsed');
                previewsContainer.classList.add('dock-collapsed');
                dockToggleButton.textContent = '弹出'; 
            } else {
                mainDock.classList.remove('collapsed');
                previewsContainer.classList.remove('dock-collapsed');
                dockToggleButton.textContent = '收起'; 
            }
            saveSetting(STORAGE_KEYS.DOCK_COLLAPSED, isCollapsed);
        }

        globalFontSizeSlider.addEventListener('input', (e) => {
            const fontSize = e.target.value + 'px';
            globalFontSizeValue.textContent = e.target.value + 'px';

            document.querySelectorAll('.font-preview-text').forEach(preview => {
                preview.style.fontSize = fontSize;
            });
            saveSetting(STORAGE_KEYS.FONT_SIZE, e.target.value); 
        });
        
        globalLetterSpacingSlider.addEventListener('input', (e) => {
            const spacing = e.target.value + 'px';
            globalLetterSpacingValue.textContent = spacing;

            document.querySelectorAll('.font-preview-text').forEach(preview => {
                preview.style.letterSpacing = spacing;
            });
            saveSetting(STORAGE_KEYS.SPACING, e.target.value); 
        });

        // 收起/弹出按钮事件
        if (dockToggleButton) {
            dockToggleButton.addEventListener('click', () => {
                isDockCollapsed = !isDockCollapsed;
                applyDockState(isDockCollapsed); 
            });
        }

        
        // 分类筛选按钮事件
        if (licenseFilterContainer) {
            licenseFilterContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('license-filter-btn') && !e.target.classList.contains('active')) {
                    
                    licenseFilterContainer.querySelectorAll('.license-filter-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    e.target.classList.add('active');
                    
                    currentLicenseFilter = e.target.getAttribute('data-license-key');
                    
                    saveSetting(STORAGE_KEYS.LICENSE_FILTER, currentLicenseFilter);
                    applyFilters();
                }
            });
        }
        
        // --- 文本输入控制事件 (不变) ---

        function updateAllFontPreviews(newText) {
             document.querySelectorAll('.font-preview-text').forEach(preview => {
                preview.textContent = newText;
            });
        }

        globalTextInput.addEventListener('input', (e) => {
            updateAllFontPreviews(e.target.value);
            saveSetting(STORAGE_KEYS.TEXT, e.target.value); 
        });
        
        // ********************* 关闭通知的事件 (不变) *********************
        if (confirmNoticeBtn) {
            confirmNoticeBtn.addEventListener('click', () => {
                bottomNoticeBar.classList.add('hidden'); 
            });
        }
        // **************************************************************

        // --- 页面加载完成后执行初始化 ---
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            injectLocalFontFaces();
            renderHeader();
            initializeNavigationEvents(); 

            const initialFontSize = globalFontSizeSlider.value + 'px';
            globalFontSizeValue.textContent = initialFontSize;
            const initialSpacing = globalLetterSpacingSlider.value + 'px';
            globalLetterSpacingValue.textContent = initialSpacing;
            
            initializeFontPreviews(); 
            
            document.querySelectorAll('.font-preview-text').forEach(preview => {
                preview.style.fontSize = initialFontSize;
                preview.style.letterSpacing = initialSpacing;
            });
            
            if (licenseFilterContainer) {
                licenseFilterContainer.querySelectorAll('.license-filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                const activeBtn = licenseFilterContainer.querySelector(`[data-license-key="${currentLicenseFilter}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                } else {
                    licenseFilterContainer.querySelector(`[data-license-key="all"]`).classList.add('active');
                    currentLicenseFilter = 'all'; 
                }
            }
            
            applyDockState(isDockCollapsed);

            document.body.style.opacity = '1'; 
        });
    </script>

</body>
</html>